<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            Reset Password - Magister Portal
        </title>
        <meta charset="UTF-8">
        <meta name="description" content="Reset your Magister Portal password">
        <meta name="keywords" content="Science, Philosophy, Spirituality, News, Art, Music, Education, Business">
        <meta name="author" content="Kabanda Ivan">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="robots" content="noindex, nofollow">
        <link rel="canonical" href="https://www.magisterportal.com/reset-password.html">
        <link rel="stylesheet" href="MagisterPortal.css">
        <script src="MagisterPortal.js" defer></script>
    </head>
    <body>
        <header> 
            <div class="header-left">
                <img src="Magister Portal Logo.jpg" alt="Magister Portal Logo">
                <h1><a href="MagisterPortal.html">Magister Portal</a></h1>
            </div>
            <nav> 
                <ul>
                    <li><a href="MagisterPortal.html">Home</a></li>
                    <li><a href="Blog.html">Blog</a></li>
                    <li><a href="About.html">About</a></li>
                    <li><a href="Contact.html">Contact</a></li>
                    <li><a href="Login.html">Login</a></li>
                </ul>
            </nav>
             <div class="header-right">
                <input type="text" class="search-bar" placeholder="Search..." />
            </div>
        </header>
        <section class="content login">
            <form id="resetPasswordForm">
                <h2>Reset Password</h2>
                <p>Enter your new password below</p>

                <label for="token">Reset Token:</label>
                <input type="text" name="token" id="token" required readonly />

                <label for="newPassword">New Password:</label>
                <input type="password" name="newPassword" id="newPassword" required />
                <small>Password must be at least 6 characters and contain at least one number</small>

                <label for="confirmPassword">Confirm Password:</label>
                <input type="password" name="confirmPassword" id="confirmPassword" required />

                <button type="submit">Reset Password</button>

                <p id="resetStatus"></p>

                <p><a href="Login.html">Back to Login</a></p>
            </form>
        </section>
        <footer>
            <p>
                Â© 2025 Magister Portal. All rights reserved.
            </p>   
           <nav class="footer-socials">
                <ul>
                    <li><a href="https://www.facebook.com/profile.php?id=61585166609921" target="_blank">Facebook</a></li>
                    <li><a href="#" target="_blank">X [Twitter]</a></li>
                    <li><a href="#" target="_blank">TikTok</a></li>
                    <li><a href="#" target="_blank">WhatsApp</a></li>
                    <li><a href="#" target="_blank">Instagram</a></li>
                </ul>
            </nav>
        </footer>
        <script>
            // Get token from URL
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                document.getElementById('token').value = token;
            } else {
                document.getElementById('resetStatus').textContent = 'Invalid reset link. Please request a new password reset.';
                document.getElementById('resetStatus').style.color = 'red';
                document.getElementById('resetPasswordForm').style.display = 'none';
            }

            // Handle form submission
            document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const resetToken = document.getElementById('token').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const status = document.getElementById('resetStatus');

                // Validation
                if (newPassword !== confirmPassword) {
                    status.textContent = 'Passwords do not match.';
                    status.style.color = 'red';
                    return;
                }

                if (newPassword.length < 6) {
                    status.textContent = 'Password must be at least 6 characters long.';
                    status.style.color = 'red';
                    return;
                }

                if (!/\d/.test(newPassword)) {
                    status.textContent = 'Password must contain at least one number.';
                    status.style.color = 'red';
                    return;
                }

                status.textContent = 'Resetting password...';
                status.style.color = 'blue';

                try {
                    const API_URL = window.location.origin.includes('localhost') 
                        ? 'http://localhost:3000/api' 
                        : '/api';

                    const response = await fetch(`${API_URL}/recover/reset`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ token: resetToken, newPassword })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Failed to reset password');
                    }

                    status.textContent = data.message || 'Password reset successful! Redirecting to login...';
                    status.style.color = 'green';

                    setTimeout(() => {
                        window.location.href = 'Login.html';
                    }, 2000);
                } catch (error) {
                    status.textContent = error.message || 'Error resetting password. Try again.';
                    status.style.color = 'red';
                }
            });
        </script>
    </body>
</html>

